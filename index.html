<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Prov ‚Äì Fr√•gebank</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b0c10; color: #eaeaea; }
    .wrap { max-width: 920px; margin: 0 auto; padding: 20px; }
    .card { background: #12141b; border: 1px solid #24283a; border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .muted { color: #a8b0c0; font-size: 14px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .spacer { flex: 1; }
    .pill { font-size: 12px; padding: 4px 10px; border-radius: 999px; border: 1px solid #24283a; background: #0f1220; color: #a8b0c0; }
    .progress { height: 10px; background: #0f1220; border: 1px solid #24283a; border-radius: 999px; overflow: hidden; }
    .bar { height: 100%; width: 0%; background: #3b82f6; }
    .q { font-size: 18px; margin: 14px 0 10px; line-height: 1.35; }
    .choices { display: grid; gap: 10px; margin: 10px 0 0; }
    .choice {
      width: 100%;
      text-align: left;
      padding: 12px 12px;
      border-radius: 12px;
      background: #0f1220;
      border: 1px solid #24283a;
      color: #eaeaea;
      cursor: pointer;
    }
    .choice:hover { border-color: #3b82f6; }
    .choice[disabled] { opacity: .75; cursor: not-allowed; }
    .feedback { margin-top: 12px; padding: 12px; border-radius: 12px; border: 1px solid #24283a; background: #0f1220; display: none; line-height: 1.4; }
    .ok { border-color: #16a34a; }
    .bad { border-color: #ef4444; }
    .warn { border-color: #f59e0b; }
    .btn { padding: 10px 14px; border-radius: 12px; border: 1px solid #24283a; background: #0f1220; color: #eaeaea; cursor: pointer; }
    .btn.primary { background: #1b2b5a; border-color: #3b82f6; }
    .btn[disabled] { opacity: .6; cursor: not-allowed; }

    .resultGrid { display: grid; gap: 10px; margin-top: 14px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    .resultItem { padding: 12px; border: 1px solid #24283a; border-radius: 12px; background: #0f1220; }
    .big { font-size: 28px; font-weight: 700; }
    .small { font-size: 13px; color: #a8b0c0; }

    .imgCard { margin-top: 12px; border:1px solid #24283a; border-radius:12px; background:#0f1220; padding: 12px; }
    .imgCard img { width: 100%; max-width: 820px; border-radius: 12px; display:block; }

    .wrongList { margin-top: 14px; display: grid; gap: 10px; }
    .wrongItem { padding: 12px; border: 1px solid #24283a; border-radius: 12px; background: #0f1220; }
    .wrongTitle { font-weight: 700; margin-bottom: 6px; }
    .wrongMeta { color:#a8b0c0; font-size: 13px; margin-top: 6px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <h1 id="title">Prov</h1>
      <div class="spacer"></div>
      <span class="pill" id="counter">0 / 0</span>
    </div>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="q" id="questionText"></div>
    <div class="choices" id="choices"></div>
    <div class="feedback" id="feedback"></div>

    <div class="row" style="margin-top: 14px;">
      <button class="btn" id="restartBtn" type="button" style="display:none;">Starta om</button>
      <div class="spacer"></div>
      <button class="btn primary" id="nextBtn" type="button" disabled>N√§sta</button>
    </div>

    <div class="muted" style="margin-top: 10px;" id="footerHint"></div>
  </div>
</div>

<script>
/*****************************************************************
 * KONFIG (ENBART LOKALT ‚Äì inget skickas n√•gonstans)
 *****************************************************************/
const TOTAL_QUESTIONS = 25;
const PASS_PERCENT = 70;
const PASS_REQUIRED = (total) => Math.ceil((PASS_PERCENT/100) * total);
const TODAY_SV = () => new Date().toLocaleDateString("sv-SE");

/*****************************************************************
 * HJ√ÑLPFUNKTIONER
 *****************************************************************/
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function validateCorrectIndex(q) {
  return Number.isInteger(q.correctIndex) && q.correctIndex >= 0 && q.correctIndex <= 3;
}

function pickRandomQuestions(bank, n) {
  if (bank.length < n) throw new Error(`Fr√•gebanken (${bank.length}) √§r mindre √§n n (${n}).`);
  const copy = bank.slice();
  shuffle(copy);
  return copy.slice(0, n);
}

/*****************************************************************
 * FR√ÖGEBANK (55 fr√•gor)
 *****************************************************************/
const QUESTION_BANK = [
  { id: "Q001", text: "N√§r kom den f√∂rsta ‚Äùskyddslagen‚Äù till skydd f√∂r milit√§ra anl√§ggningar mot t.ex. spioneri?", choices: ["2010", "1913", "1940", "1990"], correctIndex: 1 },
  { id: "Q002", text: "Hur m√•nga avdelningar inneh√•ller den s.k. brottskatalogen i Brottsbalken?", choices: ["4", "6", "3", "5"], correctIndex: 0 },
  { id: "Q003", text: "Vilken titel har chefen f√∂r en Tingsr√§tt?", choices: ["R√•dman", "N√§mndeman", "Hovr√§ttsr√•d", "Lagman"], correctIndex: 3 },
  { id: "Q004", text: "I vilken ordning kommer de allm√§nna domstolar som d√∂mer i bl.a. brottm√•l?", choices: ["K√§mn√§rsr√§tt, F√∂rvaltningsr√§tt, Europadomstolen", "Polisr√§tt, Polis√∂verr√§tt, Regeringsr√§tten", "Tingsr√§tt, Hovr√§tt, H√∂gsta domstolen", "F√∂rvaltningsr√§tt, Kammarr√§tt, H√∂gsta f√∂rvaltningsdomstolen"], correctIndex: 2 },
  { id: "Q005", text: "Hur l√•ng tid kan F√∂rsvarsmakten besluta om tillf√§lliga skyddsobjekt innan L√§nsstyrelsen m√•ste ta √∂ver det?", choices: ["3 dagar", "Det finns ingen gr√§ns", "L√§nsstyrelsen m√•ste besluta fr√•n dag 1", "30 dagar"], correctIndex: 3 },
  { id: "Q006", text: "Vem beslutade om att n√•got skulle vara skyddsf√∂rem√•l i 1940 √•rs lag?", choices: ["F√∂rsvarsomr√•desbef√§lhavaren", "Regementschefen", "H√∂gste milit√§re befallningshavare p√• platsen", "Milit√§romr√•desbef√§lhavaren"], correctIndex: 2 },
  { id: "Q007", text: "Vilket √§r det senaste brottet som tillf√∂rts skyddslagens 1¬ß?", choices: ["Spioneri", "Grovt r√•n", "Obeh√∂rigt tilltr√§de till skyddsobjekt", "Terroristbrott"], correctIndex: 1 },
  { id: "Q008", text: "Vem f√∂runders√∂kningsleder normalt brott mot en speciallag, som skyddslagen?", choices: ["Polisen", "R√•dmannen", "Lagmannen", "√Öklagaren"], correctIndex: 3 },
  { id: "Q009", text: "Vilka l√§nders soldater och sj√∂m√§n kan, med lagst√∂d bevaka skyddsobjekt?", choices: ["USA och Finland", "Endast Finland", "Endast USA", "Alla medlemsstater i NATO"], correctIndex: 0 },
  { id: "Q010", text: "Kan en Portugisisk jagare (√∂rlogsfartyg) f√∂rklara som skyddsobjekt?", choices: ["Ja, men bara i krig", "Nej, det kan bara jagare fr√•n USA och Finland", "Ja, alltid", "Nej, eftersom hon inte kan bevakas av skyddsvakter fr√•n Portugal"], correctIndex: 2 },
  { id: "Q011", text: "Vem best√§mmer om hur en civil skyddsvakt ska utbildas?", choices: ["Bevakningsbranschens yrkes- och arbetsmilj√∂r√•d", "Varje l√§nsstyrelse", "Polismyndigheten", "F√∂rsvarsmakten"], correctIndex: 2 },
  { id: "Q012", text: "N√§r var F√∂rsvarsmakten tvungen att b√∂rja utbilda skyddsvakter?", choices: ["Efter skyddslagen 1990", "Efter skyddslagen 2010", "Efter brottsbalken kom 1962", "Efter duellen mellan polis och hemv√§rn i Malmk√∂ping 1979"], correctIndex: 0 },
  { id: "Q013", text: "Var best√§ms hur en amerikansk soldat ska utbildas f√∂r att f√• bevaka ett skyddsobjekt?", choices: ["I F√∂rsvarsmaktens arbetsordning", "Ingenstans, eftersom de inte √§r skyddsvakter", "I skyddsf√∂rordningen (2010:523)", "I DCA-avtalet"], correctIndex: 1 },
  { id: "Q014", text: "Har en amerikansk soldat som bevakar ett skyddsobjekt lagst√∂d f√∂r att kroppsvisitera n√•gon?", choices: ["Ja, enligt skyddslagens 11¬ß", "Ja, enligt polislagens 19¬ß, 1 st.", "Nej, eftersom de inte √§r skyddsvakter", "Ja, enligt b√•de skyddslagen ¬ß 11 och polislagen ¬ß 19, 1 st."], correctIndex: 3 },
  { id: "Q015", text: "N√§r blev obeh√∂rigt tilltr√§de till skyddsobjekt ett sj√§lvst√§ndigt brott?", choices: ["17 maj 1990, n√§r ny skyddslag beslutades", "15 augusti 2024, n√§r skyddslagen reviderades", "1 juli 2018, n√§r skyddslagen reviderades", "17 maj 1940, d√• ny skyddslag beslutades"], correctIndex: 2 },
  { id: "Q016", text: "N√§r gick U-137 p√• grund i Karlskrona sk√§rg√•rd:", choices: ["27 oktober 1981", "9 april 1940", "11 september 2001", "2 augusti 1990"], correctIndex: 0 },
  { id: "Q017", text: "Vilka civila skyddsobjekt bevakar F√∂rsvarsmakten varje dag?", choices: ["FRA p√• Lov√∂n och Stockholms slott", "Stockholms slott och Riddarholmskyrkan", "Stockholms slott, Drottningholms slott och Solliden p√• √ñland", "Stockholms slott och Drottningholms slott"], correctIndex: 3 },
  { id: "Q018", text: "I vilket kapitel i brottsbalken hittar du brottet spioneri?", choices: ["8. kapitlet", "19. kapitlet", "3. kapitlet", "12. kapitlet"], correctIndex: 1 },
  { id: "Q019", text: "Vad √§r ett viktigt rekvisit f√∂r att en g√§rning ska bed√∂mas vara spioneri?", choices: ["Att man stj√§l k√§nsliga uppgifter", "Att man r√∂jer k√§nsliga uppgifter", "Att man l√§mnar uppgifter till fr√§mmande makt", "Att man √§r v√•rdsl√∂s med k√§nsliga uppgifter"], correctIndex: 2 },
  { id: "Q020", text: "Vad avg√∂r hur mycket tid √•klagare har p√• sig f√∂r att l√§mna in en h√§ktningsframst√§llan?", choices: ["Tiden b√∂rjar r√§knas vid den tidpunkt d√• skyddsvakten omh√§ndertagit eller gripit n√•gon", "Tiden b√∂rjar r√§knas vid den tidpunkt d√• skyddsvakten har tagit ett beslag", "Tiden b√∂rjar r√§knas vid den tidpunkt d√• skyddsvakten l√§mnat √∂ver en frihetsber√∂vad person till polisen", "Tiden b√∂rjar r√§knas vid den tidpunkt d√• skyddsvakten rapporterat om sitt ingripande till h√∂gre chef"], correctIndex: 0 },
  { id: "Q021", text: "N√§r ska √•klagaren senast l√§mna in en h√§ktningsframst√§llan?", choices: ["Senast kl 12:00 den tredje dagen efter frihetsber√∂vandet", "Efter max 72 timmar fr√•n det att polisen tagit √∂ver ansvaret", "Inom 96 timmar", "Senast kl 18:00 den tredje dagen efter frihetsber√∂vandet"], correctIndex: 0 },
  { id: "Q022", text: "Hur l√§nge kan den som √§r sk√§ligen misst√§nkt f√∂r brott sitta h√§ktad innan ett nytt beslut m√•ste fattas?", choices: ["2 veckor", "1 vecka", "96 timmar", "72 timmar"], correctIndex: 1 },
  { id: "Q023", text: "Vem best√§mmer att skyddsvakten som ingripit ska vittna i en domstol?", choices: ["Tingsr√§tten", "F√∂runders√∂kningsledaren, √•klagaren eller lagmannen", "Lagmannen, √•klagaren eller den misst√§nktes advokat", "√Öklagaren, den √•talade eller dennes f√∂rsvarare"], correctIndex: 3 },
  { id: "Q024", text: "√Ñr du skyldig att vittna i domstol?", choices: ["Ja, vi har allm√§n vittnesplikt", "Ja, men bara frivilligt", "Nej, det √§r upp till var och en", "Nej, inte om du inte sett n√•got"], correctIndex: 0 },
  { id: "Q025", text: "Vad betyder det att vara m√•ls√§gande i ett brott?", choices: ["Att du har beg√•tt ett brott", "Att du har drabbats av ett brott", "Att du misst√§nks f√∂r ett brott", "Att du bevittnat ett brott"], correctIndex: 1 },
  { id: "Q026", text: "Vem beslutar om att den misst√§nkte ska f√• en offentlig f√∂rsvarare?", choices: ["√Öklagaren", "Domstolen", "Polisen", "Advokatsamfundet"], correctIndex: 1 },
  { id: "Q027", text: "Vad av nedan uppr√§knade begrepp √§r att betrakta som p√•f√∂ljd av ett brott?", choices: ["Parkeringsb√∂ter, √∂vervakning och f√§ngelse", "F√∂rverkad, sluten ungdomsv√•rd och exekutiv auktion", "Extratj√§nst, l√∂neavdrag och b√∂ter", "B√∂ter, skyddstillsyn och f√§ngelse"], correctIndex: 3 },
  { id: "Q028", text: "Under en r√§tteg√•ng h√∂r du √•klagaren st√§lla fr√•gor till den tilltalade. Vad betyder det?", choices: ["Att den √•talade f√•r fr√•gor", "Att vittnet f√•r fr√•gor", "Att den som drabbats av brottet f√•r fr√•gor", "Att den som tilltalas av √•klagaren f√•r fr√•gor"], correctIndex: 0 },
  { id: "Q029", text: "Vad betyder ‚Äùretroaktivf√∂rbudet‚Äù i lagstiftningssammanhang?", choices: ["Om du beg√•tt brottet den 1 april, men lagen √§ndras den 1 juni och r√§tteg√•ngen mot dig √§r den 1 augusti s√• f√•r du d√∂mas f√∂r brottet mot den nyare lagen", "Om du beg√•tt brottet den 1 april, men lagen √§ndras den 1 juni och r√§tteg√•ngen mot dig √§r den 1 augusti s√• m√•ste du d√∂mas f√∂r brottet mot den lagen som g√§llde den 1 april", "Om du beg√•tt brottet den 1 april, men lagen √§ndras den 1 juni och r√§tteg√•ngen mot dig √§r den 1 augusti s√• kan du inte d√∂mas alls, eftersom lagen √§ndrats", "Om du beg√•tt brottet den 1 april, men lagen √§ndras den 1 juni och r√§tteg√•ngen mot dig √§r den 1 augusti s√• m√•ste hela f√∂runders√∂kningen g√∂ras om eftersom lagen har √§ndrats"], correctIndex: 1 },
  { id: "Q030", text: "Vad betyder ‚Äùobest√§mbarhetsf√∂rbudet‚Äù i lagstiftningssammanhang?", choices: ["Att lagen ska vara tydlig, begriplig och precis", "Att lagen inte f√•r best√§mma vilket brott som har beg√•tts i f√∂rv√§g", "Att lagen bara kan √§ndras om den inte ger v√§gledning", "Att alla √§r lika inf√∂r lagen"], correctIndex: 0 },
  { id: "Q031", text: "Vad menas med uttrycket ‚Äùstrafflatitud‚Äù?", choices: ["Ju v√§rre brott, desto str√§ngare straff", "Var brottet geografiskt har beg√•tts", "Den undre och √∂vre gr√§nsen f√∂r straffp√•f√∂ljd vid ett visst brott", "Vem som ska straffas f√∂r vilket brott"], correctIndex: 2 },
  { id: "Q032", text: "Vad av nedanst√•ende skulle kunna karakt√§risera ett objektivt rekvisit?", choices: ["En kofot som anv√§nts vid ett inbrott", "G√§rningsmannen har varit slarvig", "Vad g√§rningsmannen k√§nde vid brottstillf√§llet", "Jag ska kunna filma det"], correctIndex: 3 },
  { id: "Q033", text: "Vad utm√§rker ett brott?", choices: ["Det √§r n√•got som det √§r f√∂rbjudet att g√∂ra", "Det √§r n√•got som det √§r straffbart att g√∂ra", "Det √§r n√•got som du m√•ste ha tillst√•nd att g√∂ra", "Det √§r n√•got som skadar andra"], correctIndex: 1 },
  { id: "Q034", text: "Vad beskriver den tredje avdelningen i brottsbalken?", choices: ["Vilka olika brott som finns", "Vilka olika domstolar som finns", "Vilka olika p√•f√∂ljder som finns och vad dessa betyder", "Vilka olika domstolar som √§r beh√∂riga"], correctIndex: 2 },
  { id: "Q035", text: "Vem beslutar om att en ny lag ska b√∂rja g√§lla?", choices: ["Justitiedepartementet", "Riksdagen", "Kungen", "Regeringen"], correctIndex: 1 },
  { id: "Q036", text: "Hur m√•nga ledam√∂ter har Sveriges riksdag?", choices: ["350", "351", "349", "271"], correctIndex: 2 },
  { id: "Q037", text: "Vad st√•r f√∂rkortningen SOU f√∂r i lagstiftningssammanhang?", choices: ["Statens ofantliga underskott", "Statens offentliga utveckling", "Statens offentliga utredningar", "Statens ofantliga uttryck"], correctIndex: 2 },
  { id: "Q038", text: "Vad utm√§rker H√∂gsta domstolen?", choices: ["De best√§mmer r√§ttspraxis genom att skapa prejudicerande domar", "Den best√•r enbart av politisk tillsatta tj√§nstem√§n", "Den finns p√• tv√• platser; Stockholm och Bryssel", "De √§r de enda i domstolsv√§rlden i Sverige som har tj√§nstedr√§kt"], correctIndex: 0 },
  { id: "Q039", text: "Vem skriver ett utskottsbet√§nkande?", choices: ["Bara justitieutskottet", "N√•got av regeringens departement", "N√•got av riksdagens 15 utskott", "Utrikesn√§mnden"], correctIndex: 2 },
  { id: "Q040", text: "Vad k√§nnetecknar det ackusatoriska processen?", choices: ["I domstolen har man en f√∂rhandling mellan √•klagare och √•talad", "I domstolen f√•r endast r√•dmannen prata", "Man spelar in allting p√• akustiska ljudband", "Det √§r endast lekmannadomare som d√∂mer i brottm√•l"], correctIndex: 0 },
  { id: "Q041", text: "Var styrs inomverksutbildningen i F√∂rsvarsmakten?", choices: ["Handbok bevakning", "Skyddsvaktsutbildning 2024", "Reglemente utbildning", "Handbok grund- och repetitionsutbildning"], correctIndex: 2 },
  { id: "Q042", text: "Vad betyder f√∂rkortningen YBK i F√∂rsvarsmaktens utbildningssystem?", choices: ["Yrkesbef√§lskurs", "Yrkes- och befattningskurs", "Yrkes- och bevakningskurs", "Ytterligare bevakningskurs"], correctIndex: 1 },
  { id: "Q043", text: "Vad g√∂r en kursarrang√∂r?", choices: ["Kursarrang√∂ren ska genomf√∂ra utbildning enligt fastst√§lld kursplan och enligt g√§llande styrningar", "Kursarrang√∂ren ska ta fram och besluta om centrala kursplaner", "Kursarrang√∂ren ska utse examinatorer", "Kursarrang√∂ren ska validera andra utbildningar mot g√§llande kursplaner"], correctIndex: 0 },
  { id: "Q044", text: "Vem √§r ansvarig f√∂r framtagande av kursplaner f√∂r utbildning av skyddsvakter inom F√∂rsvarsmakten?", choices: ["Arm√©staben", "Hemv√§rnets strids- och skjutskola", "F√∂rsvarsmaktens underr√§ttelse- och s√§kerhetscentrum", "F√∂rsvarsstabens juridiska avdelning"], correctIndex: 2 },
  { id: "Q045", text: "Du ska h√•lla en kurs f√∂r nya skyddsvakter vid ditt f√∂rband. Vem bereder kursbeskrivningen och vem fastst√§ller den?", choices: ["Kursansvarig bereder, kursarrang√∂ren, d.v.s. C OrgE (f√∂rbandschefen) fastst√§ller", "Kurschef eller huvudl√§raren bereder, kursarrang√∂ren, d.v.s. C OrgE (f√∂rbandschefen) fastst√§ller", "Kurschef eller huvudl√§raren bereder, kursansvarig, d.v.s. arm√©staben fastst√§ller", "Kurschef eller kursarrang√∂r bereder, kursansvarig, d.v.s. C FMUndS√§kC fastst√§ller"], correctIndex: 1 },
  { id: "Q046", text: "Vad tycker b√§st beskriver en Skyddsvakt i F√∂rsvarsmakten av alternativen nedan?", choices: ["En obligatoriskt utbildad person som ska g√• h√∂gvakt, oavsett befattning", "F√∂rsvarsmaktens svar p√• ordningsvakten i det civila livet", "Skyddsvakten √§r en tj√§nsteman som i sin befattning inom skydd- och bevakningsomr√•det f√∂retr√§der myndigheten i sin myndighetsut√∂vning", "Skyddsvakten √§r en person med r√§tt utbildning, p√• r√§tt plats som ska h√•lla ordning p√• v√•ra soldater"], correctIndex: 2 },
  { id: "Q047", text: "Vem fattar beslut om att anv√§nda tv√•ngsmedel av nedanst√•ende, och vad tycker du st√§mmer b√§st av p√•st√•endena om utbildning?", choices: ["Det g√∂r enskild skyddsvakt. Det √§r d√§rf√∂r det √§r viktigt att ge alla en r√§ttss√§ker utbildning", "Det g√∂r skyddsvaktens chef. Skyddsvakten beh√∂ver d√§rf√∂r inte n√•gon s√§rskild juridisk skolning", "Det g√∂r vakthavande bef√§l. Bara en officer har r√§tt utbildning f√∂r att fatta korrekta juridiska beslut", "Det g√∂r f√∂rbandschefen. Endast en myndighetschef kan ges ansvaret att fatta juridiska beslut"], correctIndex: 0 },
  { id: "Q048", text: "Vilka krav st√§lls det p√• en skyddsvaktsinstrukt√∂r?", choices: ["Att denne √§r r√§tt utrustad och har skyddsvaktsbevis", "Att denne √§r utbildad och godk√§nd av polismyndigheten", "Att denne √§r utbildad enligt en av C FMUndS√§kC fastst√§lld kursplan", "Att denne har 15 h√∂gskolepo√§ng i juridik"], correctIndex: 2 },
  { id: "Q049", text: "Vad st√§lls det f√∂r krav p√• en kursdeltagare f√∂r att bli antagen till skyddsvaktsinstrukt√∂rskursen ?", choices: ["Godk√§nd officers- eller specialistofficersutbildning", "Godk√§nd grundkurs instrukt√∂r eller motsvarande kunskap i trupputbildning", "Godk√§nd grundkurs i juridik", "Godk√§nd utbildning i kursadministration"], correctIndex: 1 },
  { id: "Q050", text: "Vem kvalitetss√§krar F√∂rsvarsmaktens inomverksutbildning?", choices: ["Kursansvarig", "Kursarrang√∂ren", "Huvudl√§raren", "F√∂rbandschefen"], correctIndex: 0 },
  { id: "Q051", text: "Vilka betygsniv√•er har examinationen i v√•r inomverksutbildning?", choices: ["Godk√§nd eller icke godk√§nd", "V√§l godk√§nd, godk√§nd och icke godk√§nd", "Mycket v√§l godk√§nd, v√§l godk√§nd, godk√§nd och icke godk√§nd", "Betyg 1-5 d√§r 1 √§r underk√§nd"], correctIndex: 0 },
  { id: "Q052", text: "Skyddsvakt grund har kurskoden UND424ISF45. Vad st√•r den f√∂rsta fyran f√∂r?", choices: ["F√∂rdjupad kunskap", "Avancerad kunskap", "Specialiserad kunskap", "Grundkunskap"], correctIndex: 0 },
  { id: "Q053", text: "Vad av nedan alternativ ska ing√• i en kursplan?", choices: ["Kursens krigsf√∂rbandskod", "Kursens f√∂rkunskapskrav", "Kursens kostnad", "Kursens stridskraftstillh√∂righet"], correctIndex: 1 },
  { id: "Q054", text: "Vilket nedan √§r ett exempel p√• en kursplanerevidering?", choices: ["Kursen har nya l√§randem√•l", "Kursen har nya f√∂rkunskapskrav", "Kursens examinationsform har √§ndrats", "Kursen har f√•tt ny kursansvarig"], correctIndex: 2 },
  { id: "Q055", text: "Vad ska framg√• av en kursbeskrivning?", choices: ["Hur kursen ska genomf√∂ras s√• att n√•gon annan kan genomf√∂ra den om kurschefen blir sjuk", "Vilka f√∂rkunskapskrav som kr√§vs f√∂r att f√• h√•lla kursen, kopplat till kurschefens kompetens", "Vem som genomf√∂rt kursrevideringen i den senaste √§ndringen", "Ett beslut fr√•n kursansvarig om att f√• h√•lla kursen"], correctIndex: 0 },
];

/*****************************************************************
 * FEEDBACK PER FR√ÖGA (fyll i senare)
 * - explanation: din f√∂rklaring (kort)
 * - where: var man hittar info (lagrum, handbok, kapitel, sida, osv.)
 *****************************************************************/
const FEEDBACK_BY_ID = {};

// Tomma platsh√•llare f√∂r alla fr√•gor (fyll i n√§r du vill)
FEEDBACK_BY_ID.Q001 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q002 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q003 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q004 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q005 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q006 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q007 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q008 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q009 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q010 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q011 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q012 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q013 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q014 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q015 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q016 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q017 = { explanation: "", where: "" };

// EXEMPEL ifyllt (som du bad om)
FEEDBACK_BY_ID.Q018 = {
  explanation: "Spioneri ligger under brott mot rikets s√§kerhet.",
  where: "Brottsbalken 19 kap. (brott mot rikets s√§kerhet)."
};

FEEDBACK_BY_ID.Q019 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q020 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q021 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q022 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q023 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q024 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q025 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q026 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q027 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q028 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q029 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q030 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q031 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q032 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q033 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q034 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q035 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q036 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q037 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q038 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q039 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q040 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q041 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q042 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q043 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q044 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q045 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q046 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q047 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q048 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q049 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q050 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q051 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q052 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q053 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q054 = { explanation: "", where: "" };
FEEDBACK_BY_ID.Q055 = { explanation: "", where: "" };

function getFeedbackFor(q) {
  return FEEDBACK_BY_ID[q.id] || null;
}

/*****************************************************************
 * UI + LOGIK
 *****************************************************************/
let examQuestions = [];
let idx = -1;
let answered = false;
let correctCount = 0;
let wrongCount = 0;

const userAnswerById = new Map(); // QID -> chosen index
const isCorrectById = new Map();  // QID -> boolean

const titleEl = document.getElementById("title");
const counterEl = document.getElementById("counter");
const barEl = document.getElementById("bar");
const questionText = document.getElementById("questionText");
const choicesEl = document.getElementById("choices");
const feedbackEl = document.getElementById("feedback");
const nextBtn = document.getElementById("nextBtn");
const restartBtn = document.getElementById("restartBtn");
const footerHint = document.getElementById("footerHint");

function setProgress(i, total) {
  const shown = Math.max(0, i + 1);
  counterEl.textContent = `${Math.min(shown, total)} / ${total}`;
  barEl.style.width = total ? `${(Math.min(shown, total)/total)*100}%` : "0%";
}

function resetFeedback() {
  feedbackEl.style.display = "none";
  feedbackEl.className = "feedback";
  feedbackEl.textContent = "";
  feedbackEl.innerHTML = "";
}

function lockChoices(lock) {
  [...choicesEl.querySelectorAll("button.choice")].forEach(b => b.disabled = lock);
}

function renderStart() {
  titleEl.textContent = "Prov ‚Äì Start";
  questionText.textContent = "Tryck p√• start f√∂r att b√∂rja provet.";
  footerHint.textContent = `25 fr√•gor slumpas vid varje start. Godk√§nt: ${PASS_PERCENT}%.`;

  choicesEl.innerHTML = `
    <div class="row" style="margin-top:12px;">
      <button class="btn primary" id="startBtn" type="button">Starta prov</button>
    </div>
  `;

  resetFeedback();
  restartBtn.style.display = "none";
  nextBtn.disabled = true;
  counterEl.textContent = `0 / ${TOTAL_QUESTIONS}`;
  barEl.style.width = "0%";

  const startBtn = document.getElementById("startBtn");

  startBtn.addEventListener("click", () => {
    try {
      const missing = QUESTION_BANK.find(q => !validateCorrectIndex(q));
      if (missing) throw new Error(`Saknar/ogiltig correctIndex (0-3) f√∂r: ${missing.id}`);

      examQuestions = pickRandomQuestions(QUESTION_BANK, TOTAL_QUESTIONS);
      shuffle(examQuestions);

      userAnswerById.clear();
      isCorrectById.clear();

      startExam();
    } catch (e) {
      feedbackEl.style.display = "block";
      feedbackEl.classList.add("warn");
      feedbackEl.textContent = `‚ö†Ô∏è ${e.message}`;
    }
  });
}

function startExam() {
  idx = 0;
  answered = false;
  correctCount = 0;
  wrongCount = 0;

  restartBtn.style.display = "none";
  nextBtn.disabled = true;
  nextBtn.textContent = "N√§sta";

  renderQuestion(idx);
}

function renderQuestion(i) {
  const q = examQuestions[i];
  titleEl.textContent = "Fr√•ga";
  questionText.textContent = q.text;
  footerHint.textContent = `${q.id}`;

  choicesEl.innerHTML = "";
  resetFeedback();

  answered = false;
  nextBtn.textContent = (i === examQuestions.length - 1) ? "Visa resultat" : "N√§sta";
  nextBtn.disabled = true;

  q.choices.forEach((txt, ci) => {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "choice";
    b.textContent = txt;
    b.addEventListener("click", () => handleAnswer(ci));
    choicesEl.appendChild(b);
  });

  setProgress(i, examQuestions.length);
}

function handleAnswer(choiceIndex) {
  if (answered) return;
  answered = true;

  const q = examQuestions[idx];
  const isCorrect = choiceIndex === q.correctIndex;

  userAnswerById.set(q.id, choiceIndex);
  isCorrectById.set(q.id, isCorrect);

  lockChoices(true);
  feedbackEl.style.display = "block";

  const fb = getFeedbackFor(q);
  const correctTxt = q.choices[q.correctIndex];

  // Nollst√§ll
  feedbackEl.className = "feedback";
  feedbackEl.innerHTML = "";

  const exp = (fb?.explanation || "").trim();
  const where = (fb?.where || "").trim();

  if (isCorrect) {
    correctCount++;
    feedbackEl.classList.add("ok");

    // ‚úÖ R√§tt ‚Äì INGEN extra feedback
    const title = document.createElement("div");
    title.textContent = "‚úÖ R√§tt!";
    feedbackEl.appendChild(title);

  } else {
    wrongCount++;
    feedbackEl.classList.add("bad");

    // ‚ùå Fel + r√§tt svar
    const title = document.createElement("div");
    title.innerHTML = `‚ùå Fel. R√§tt svar: <strong>${correctTxt}</strong>`;
    feedbackEl.appendChild(title);

    // ‚úÖ Feedback visas ENDAST vid fel (om du fyllt i den)
    if (exp || where) {
      const info = document.createElement("div");
      info.className = "muted";
      info.style.marginTop = "8px";
      info.innerHTML = `
        ${exp ? `<div>${exp}</div>` : ""}
        ${where ? `<div style="margin-top:6px;">üìå Var hittar du det? ${where}</div>` : ""}
      `;
      feedbackEl.appendChild(info);
    }
  }

  nextBtn.disabled = false;
}

function roundRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y, x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x, y+h, r);
  ctx.arcTo(x, y+h, x, y, r);
  ctx.arcTo(x, y, x+w, y, r);
  ctx.closePath();
}

async function renderResult() {
  titleEl.textContent = "Resultat";
  const total = examQuestions.length;
  const pct = Math.round((correctCount / total) * 100);
  const required = PASS_REQUIRED(total);
  const passed = correctCount >= required;

  questionText.textContent = "Sammanst√§llning:";
  footerHint.textContent = "";

  // bygg fel-lista
  const wrongItems = examQuestions
    .filter(q => isCorrectById.get(q.id) === false)
    .map(q => {
      const userIdx = userAnswerById.get(q.id);
      const userTxt = (Number.isInteger(userIdx) ? q.choices[userIdx] : "‚Äî");
      const correctTxt = q.choices[q.correctIndex];
      const fb = getFeedbackFor(q);
      const exp = (fb?.explanation || "").trim();
      const where = (fb?.where || "").trim();
      return { q, userTxt, correctTxt, exp, where };
    });

  const wrongHtml = wrongItems.length ? `
    <div style="margin-top:14px;" class="muted">Fel fr√•gor (med din feedbackmall):</div>
    <div class="wrongList">
      ${wrongItems.map((it, k) => `
        <div class="wrongItem">
          <div class="wrongTitle">${k+1}. <span class="mono">${it.q.id}</span> ‚Äì ${it.q.text}</div>
          <div class="wrongMeta">Ditt svar: <strong>${it.userTxt}</strong></div>
          <div class="wrongMeta">R√§tt svar: <strong>${it.correctTxt}</strong></div>
          ${it.exp ? `<div class="wrongMeta">F√∂rklaring: <strong>${it.exp}</strong></div>` : ""}
          ${it.where ? `<div class="wrongMeta">Var hittar du det? <strong>${it.where}</strong></div>` : ""}
        </div>
      `).join("")}
    </div>
  ` : `
    <div style="margin-top:14px;" class="muted">Inga fel ‚Äì snyggt!</div>
  `;

  choicesEl.innerHTML = `
    <div class="resultGrid">
      <div class="resultItem"><div class="big">${correctCount} / ${total}</div><div class="small">Antal r√§tt</div></div>
      <div class="resultItem"><div class="big">${pct}%</div><div class="small">R√§ttprocent</div></div>
      <div class="resultItem"><div class="big">${TODAY_SV()}</div><div class="small">Datum</div></div>
      <div class="resultItem" style="border-color:${passed ? "#16a34a" : "#ef4444"};">
        <div class="big">${passed ? "GODK√ÑND" : "UNDERK√ÑND"}</div>
        <div class="small">Krav: ${PASS_PERCENT}% (${required} r√§tt)</div>
      </div>
    </div>

    ${wrongHtml}

    <div class="imgCard">
      <div class="muted" style="margin-bottom:8px;">Resultatbild</div>
      <canvas id="resultCanvas" width="1200" height="630" style="display:none;"></canvas>
      <img id="resultImg" alt="Resultatbild"/>
      <div class="row" style="margin-top:10px;">
        <a id="downloadLink" class="btn primary" download="resultat.png" href="#">Ladda ner bild</a>
      </div>
      <div class="muted" style="margin-top:10px;">
        OBS: Inget skickas eller lagras i moln. Resultat finns bara p√• denna enhet i detta f√∂nster.
      </div>
    </div>
  `;

  // Skapa resultatbild (lokalt)
  const canvas = document.getElementById("resultCanvas");
  const ctx = canvas.getContext("2d");

  ctx.fillStyle = "#0b0c10";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  const x=60, y=60, w=1080, h=510, r=28;
  roundRect(ctx, x, y, w, h, r);
  ctx.fillStyle = "#12141b"; ctx.fill();
  ctx.lineWidth = 2; ctx.strokeStyle = "#24283a"; ctx.stroke();

  ctx.fillStyle = "#eaeaea";
  ctx.font = "700 42px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText("Provresultat", x+50, y+85);

  ctx.fillStyle = "#a8b0c0";
  ctx.font = "400 18px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(`Datum: ${TODAY_SV()}`, x+50, y+120);

  ctx.fillStyle = "#eaeaea";
  ctx.font = "500 26px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(`Antal r√§tt: ${correctCount} / ${total}`, x+50, y+200);
  ctx.fillText(`R√§ttprocent: ${pct}%`, x+50, y+245);

  ctx.font = "800 54px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillStyle = passed ? "#16a34a" : "#ef4444";
  ctx.fillText(passed ? "GODK√ÑND" : "UNDERK√ÑND", x+50, y+335);

  ctx.fillStyle = "#a8b0c0";
  ctx.font = "400 18px system-ui, -apple-system, Segoe UI, Roboto, Arial";
  ctx.fillText(`Krav: ${PASS_PERCENT}% (${required} r√§tt)`, x+50, y+370);

  const dataUrl = canvas.toDataURL("image/png");
  document.getElementById("resultImg").src = dataUrl;
  document.getElementById("downloadLink").href = dataUrl;

  resetFeedback();
  nextBtn.disabled = true;
  nextBtn.textContent = "Klar";
  setProgress(total - 1, total);
  barEl.style.width = "100%";

  restartBtn.style.display = "inline-block";
}

document.getElementById("restartBtn").addEventListener("click", () => {
  location.reload();
});

nextBtn.addEventListener("click", async () => {
  if (idx < examQuestions.length - 1) {
    idx++;
    renderQuestion(idx);
  } else {
    await renderResult();
  }
});

renderStart();
</script>
</body>
</html>
